{% extends "base.html" %}
{% block title %}Bid on Job #{{ job.id }} - JHE Haul{% endblock %}
{% block content %}
<div class="card">
    <h2>Job #{{ job.id }}</h2>
    <hr>
    <p><strong>Description:</strong><br>{{ job.job_description }}</p>
    {% if job.pickup_zip %}
    <p><strong>Area:</strong> {{ job.pickup_zip }}
        {% if approx_miles is not none %}
        <span style="background: #e3f2fd; color: #1565c0; padding: 2px 10px; border-radius: 15px; font-size: 0.85rem; font-weight: 600; margin-left: 8px;">
            Approx. {{ approx_miles }} miles away
        </span>
        {% endif %}
    </p>
    {% endif %}
    {% if job.preferred_date or job.preferred_time %}
    <p><strong>Preferred Pickup:</strong> 
        {% if job.preferred_date %}{{ job.preferred_date }}{% endif %}
        {% if job.preferred_time %} ({{ job.preferred_time.title() }}){% endif %}
    </p>
    {% endif %}
    <p style="color: #888; font-size: 0.85rem;">Exact address will unlock after booking confirmation.</p>
    
    {% if job.photos %}
    <h4>Photos</h4>
    <div class="photo-grid">
        {% for photo in job.photos %}
        <img src="/uploads/{{ photo.filename }}" alt="Job photo">
        {% endfor %}
    </div>
    {% endif %}
</div>

<div class="card">
    <h3>Submit Your Bid</h3>
    <hr>
    <form method="POST" action="{{ url_for('hauler_bid_submit', job_id=job.id) }}">
        <div class="form-group">
            <label>Your Name</label>
            <input name="hauler_name" required value="{{ current_user.first_name or '' }} {{ current_user.last_name or '' }}">
        </div>
        <div class="form-group">
            <label>Your Phone (optional)</label>
            <input name="hauler_phone" type="tel" value="{{ current_user.phone_formatted if current_user.phone else '' }}" placeholder="(555) 555-5555" maxlength="14" oninput="maskPhone(this)">
        </div>
        <div class="form-group">
            <label>Quote Amount ($)</label>
            <input name="quote_amount" type="number" step="0.01" required placeholder="Enter your price">
        </div>
        <div class="form-group">
            <label>Message (optional)</label>
            <textarea name="message" placeholder="Any additional details about your bid..."></textarea>
        </div>
        <button type="submit" class="btn btn-success">Submit Bid</button>
    </form>
</div>

<p><a href="{{ url_for('hauler_jobs') }}">Back to Open Jobs</a></p>
<script>
function maskPhone(input) {
    var x = input.value.replace(/\D/g, '').slice(0, 10);
    if (x.length === 0) { input.value = ''; return; }
    if (x.length <= 3) { input.value = '(' + x; }
    else if (x.length <= 6) { input.value = '(' + x.slice(0,3) + ') ' + x.slice(3); }
    else { input.value = '(' + x.slice(0,3) + ') ' + x.slice(3,6) + '-' + x.slice(6); }
}
</script>
{% endblock %}
