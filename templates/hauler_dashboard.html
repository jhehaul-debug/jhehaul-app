{% extends "base.html" %}
{% block title %}My Dashboard - JHE Haul{% endblock %}
{% block content %}
<h2>My Dashboard</h2>
<p>Jobs where your bid was accepted:</p>

{% if not jobs %}
<div class="card">
    <p>No accepted jobs yet. Keep bidding on open jobs!</p>
    <a href="{{ url_for('hauler_jobs') }}" class="btn btn-primary" style="margin-top: 15px;">Browse Open Jobs</a>
</div>
{% else %}
{% for job in jobs %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: start;">
        <h3>Job #{{ job.id }}</h3>
        <span class="status status-{{ job.status }}">{{ job.status.replace('_', ' ').title() }}</span>
    </div>
    <hr>
    <p><strong>Description:</strong> {{ job.job_description }}</p>
    <p><strong>Quote:</strong> ${{ "%.2f"|format(job.accepted_quote or 0) }}</p>
    {% if job.preferred_date or job.preferred_time %}
    <p><strong>Preferred Pickup:</strong> 
        {% if job.preferred_date %}{{ job.preferred_date }}{% endif %}
        {% if job.preferred_time %} ({{ job.preferred_time.title() }}){% endif %}
    </p>
    {% endif %}
    
    {% if job.status == 'deposit_paid' %}
    <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 15px;">
        <strong>Customer:</strong> {{ job.customer_name }}<br>
        {% if job.customer_phone %}<strong>Phone:</strong> {{ job.customer_phone }}<br>{% endif %}
        <strong>Pickup Address:</strong> {{ job.pickup_address }}, {{ job.pickup_zip }}
        <br><br>
        <a href="https://www.google.com/maps/dir/?api=1&destination={{ (job.pickup_address ~ ', ' ~ job.pickup_zip)|urlencode }}" 
           target="_blank" 
           class="btn btn-primary" 
           style="display: inline-block;">
            Get Directions
        </a>
        
    </div>
    {% elif job.status == 'completed' %}
    <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-top: 15px;">
        <strong>Customer:</strong> {{ job.customer_name }}<br>
        <strong>Pickup Address:</strong>
        {% if job.deposit_paid %}
          {{ job.pickup_address }}, {{ job.pickup_zip }}<br>
        {% else %}
          ðŸ”’ Hidden until customer deposit is paid<br>
        {% endif %}
        <strong>Job Completed!</strong>
        {% if job.completed_at %}<br>Completed on {{ job.completed_at.strftime('%B %d, %Y') }}{% endif %}
        <br><br>
        <a href="{{ url_for('hauler_upload_photos', job_id=job.id) }}"
           class="btn btn-secondary"
           style="display:inline-block;">
          Upload Photos
        </a>
    
    </div>
    {% elif job.status == 'accepted' %}
    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px;">
        <strong>Waiting for customer deposit confirmation.</strong><br>
        <small>The full address and customer info will unlock once the deposit is paid.</small>
    </div>
    {% else %}
    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px;">
        <strong>Exact address will unlock after booking confirmation.</strong>
    </div>
    {% endif %}
</div>
{% endfor %}
{% endif %}
{% endblock %}
