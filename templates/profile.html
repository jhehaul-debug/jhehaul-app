{% extends "base.html" %}
{% block title %}My Profile - JHE Haul{% endblock %}
{% block content %}
<div class="card">
    <h2>My Profile</h2>
    <hr>
    <form method="POST" action="{{ url_for('profile_update') }}">
        <div class="form-group">
            <label>First Name</label>
            <input name="first_name" value="{{ current_user.first_name or '' }}">
        </div>
        <div class="form-group">
            <label>Last Name</label>
            <input name="last_name" value="{{ current_user.last_name or '' }}">
        </div>
        <div class="form-group">
            <label>Email</label>
            <input value="{{ current_user.email or '' }}" disabled>
            <small style="color: #666;">Email cannot be changed</small>
        </div>
        <div class="form-group">
            <label>Phone</label>
            <input name="phone" value="{{ current_user.phone or '' }}" placeholder="Your phone number">
        </div>
        <div class="form-group">
            <label>Account Type</label>
            <input value="{{ current_user.user_type.title() if current_user.user_type else 'Not set' }}" disabled>
        </div>
        {% if current_user.user_type == 'customer' %}
        <hr>
        <h3>Notification Preferences</h3>
        <div class="form-group">
            <label>
                <input type="checkbox" name="notify_sms" value="1" {% if current_user.notify_sms %}checked{% endif %}>
                Send me text message notifications (requires phone number)
            </label>
        </div>
        {% endif %}
        {% if current_user.user_type == 'hauler' %}
        <hr>
        <h3>Travel Preferences</h3>
        <div class="form-group">
            <label>Your Home ZIP Code</label>
            <input name="home_zip" value="{{ current_user.home_zip or '' }}" placeholder="Your ZIP code" maxlength="10">
        </div>
        <div class="form-group">
            <label>Max Travel Distance (miles)</label>
            <input name="max_travel_miles" type="number" min="1" max="500" value="{{ current_user.max_travel_miles or '' }}" placeholder="e.g. 25">
            <small style="color: #666;">Jobs beyond this distance won't be shown to you</small>
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" name="notify_new_jobs" value="1" {% if current_user.notify_new_jobs != False %}checked{% endif %}>
                Email me when new jobs are posted in my area
            </label>
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" name="notify_sms" value="1" {% if current_user.notify_sms %}checked{% endif %}>
                Also send me text message notifications (requires phone number)
            </label>
        </div>
        {% endif %}
        <button type="submit" class="btn btn-success">Save Changes</button>
    </form>
    
    <hr>
    <h3>Invite Others to JHE Haul</h3>
    <p style="color: #666; margin-bottom: 15px;">Share these links with friends to invite them to join.</p>
    <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 10px;">
        <div style="flex: 1; min-width: 250px;">
            <label style="font-weight: 600; display: block; margin-bottom: 5px;">Invite a Customer</label>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="invite-customer-link" value="{{ request.host_url }}invite/customer" readonly style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; background: #f9f9f9;">
                <button onclick="copyLink('invite-customer-link', this)" class="btn btn-primary" style="padding: 10px 16px; white-space: nowrap;">Copy</button>
            </div>
        </div>
        <div style="flex: 1; min-width: 250px;">
            <label style="font-weight: 600; display: block; margin-bottom: 5px;">Invite a Hauler</label>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="invite-hauler-link" value="{{ request.host_url }}invite/hauler" readonly style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; background: #f9f9f9;">
                <button onclick="copyLink('invite-hauler-link', this)" class="btn btn-primary" style="padding: 10px 16px; white-space: nowrap;">Copy</button>
            </div>
        </div>
    </div>
    <div style="margin-top: 10px;">
        <label style="font-weight: 600; display: block; margin-bottom: 5px;">General Invite (they choose their role)</label>
        <div style="display: flex; gap: 8px;">
            <input type="text" id="invite-general-link" value="{{ request.host_url }}invite" readonly style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; background: #f9f9f9;">
            <button onclick="copyLink('invite-general-link', this)" class="btn btn-primary" style="padding: 10px 16px; white-space: nowrap;">Copy</button>
        </div>
    </div>
    <script>
    function copyLink(inputId, btn) {
        var input = document.getElementById(inputId);
        input.select();
        input.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(input.value).then(function() {
            var originalText = btn.textContent;
            btn.textContent = 'Copied!';
            btn.style.background = '#27ae60';
            setTimeout(function() { btn.textContent = originalText; btn.style.background = ''; }, 2000);
        });
    }
    </script>
    
    <hr>
    <h3>Delete Account</h3>
    <p style="color: #666;">This will permanently delete your account and all associated data. This action cannot be undone.</p>
    <form method="POST" action="{{ url_for('delete_account') }}" onsubmit="return confirm('Are you sure you want to delete your account? This cannot be undone.');">
        <button type="submit" class="btn" style="background-color: #dc3545; color: white;">Delete My Account</button>
    </form>
</div>
{% endblock %}
